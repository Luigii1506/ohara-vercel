generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DATABASE_URL_UNPOOLED")
}

model Card {
  id                    Int                 @id @default(autoincrement())
  src                   String
  imageKey              String?
  name                  String
  cost                  String?
  power                 String?
  attribute             String?
  counter               String?
  category              String
  life                  String?
  rarity                String?
  illustrator           String?
  alternateArt          String?
  status                String?
  triggerCard           String?
  code                  String
  setCode               String
  isFirstEdition        Boolean
  uuid                  String              @unique @default(uuid())
  createdAt             DateTime?           @default(now())
  updatedAt             DateTime?           @updatedAt
  tcgUrl                String?             @default("")
  tcgplayerProductId    String?             @unique
  tcgplayerLinkStatus   Boolean? // null = not attempted, false = marked missing, true = linked
  marketPrice           Decimal?
  lowPrice              Decimal?
  highPrice             Decimal?
  priceCurrency         String?             @default("USD")
  priceUpdatedAt        DateTime?
  isWatchlisted         Boolean             @default(false)
  alias                 String?             @default("")
  order                 String              @default("0")
  collectionOrder       String              @default("")
  isPro                 Boolean             @default(false)
  region                String?             // US, JP, CN, KR, TH, FR
  language              String?             // en, ja, zh-Hans, zh-Hant, ko, th, fr
  isRegionalExclusive   Boolean             @default(false)
  baseCardId            Int? // NULL si es carta base, ID de la base si es alternativa
  baseCard              Card?               @relation("CardAlternates", fields: [baseCardId], references: [id], onDelete: Cascade)
  colors                CardColor[]
  conditions            CardCondition[]
  effects               CardEffect[]
  priceLogs             CardPriceLog[]
  rulings               CardRuling[]
  sets                  CardSet[]
  texts                 CardText[]
  types                 CardType[]
  priceAlerts           CardPriceAlert[]
  alertLogs             CardPriceAlertLog[]
  adminNotifications    AdminNotification[]
  DeckCard              DeckCard[]
  opponentGameLogs      GameLog[]           @relation("OpponentLeader")
  GameLogCard           GameLogCard[]
  userListCards         UserListCard[]
  alternateCards        Card[]              @relation("CardAlternates") // Las alternativas de esta carta base
  eventCards            EventCard[]
  leaderTournamentDecks TournamentDeck[]    @relation("TournamentLeaderCard")
  productCards          ProductCard[]
  baseGroupLinks        CardGroupLink[]
  variantGroupLinks     CardVariantLink[]
  sources               CardSource[]

  @@index([baseCardId]) // √çndice para b√∫squedas r√°pidas
  @@index([code, isFirstEdition]) // √çndice compuesto para buscar cartas base por code
  @@index([code, region, isFirstEdition]) // √çndice para cartas base por region
  @@index([collectionOrder])
}

model CardGroup {
  id             Int               @id @default(autoincrement())
  canonicalCode  String
  canonicalName  String?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  variantGroups  CardVariantGroup[]
  links          CardGroupLink[]

  @@unique([canonicalCode])
}

model CardVariantGroup {
  id            Int               @id @default(autoincrement())
  baseGroupId   Int
  variantKey    String?
  alternateArt  String?
  illustrator   String?
  imageHash     String?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  baseGroup     CardGroup         @relation(fields: [baseGroupId], references: [id], onDelete: Cascade)
  links         CardVariantLink[]

  @@index([baseGroupId])
  @@index([alternateArt])
  @@index([illustrator])
}

model CardGroupLink {
  id        Int      @id @default(autoincrement())
  groupId   Int
  cardId    Int
  region    String?
  language  String?
  source    String?
  sourceId  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  group     CardGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  card      Card     @relation(fields: [cardId], references: [id], onDelete: Cascade)

  @@unique([groupId, cardId])
  @@index([cardId])
  @@index([source, sourceId])
}

model CardVariantLink {
  id             Int      @id @default(autoincrement())
  variantGroupId Int
  cardId         Int
  region         String?
  language       String?
  source         String?
  sourceId       String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  variantGroup   CardVariantGroup @relation(fields: [variantGroupId], references: [id], onDelete: Cascade)
  card           Card     @relation(fields: [cardId], references: [id], onDelete: Cascade)

  @@unique([variantGroupId, cardId])
  @@index([cardId])
  @@index([source, sourceId])
}

model CardSource {
  id        Int      @id @default(autoincrement())
  cardId    Int
  source    String
  sourceId  String
  offerType String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  card      Card     @relation(fields: [cardId], references: [id], onDelete: Cascade)

  @@unique([source, sourceId])
  @@index([cardId])
}

model Deck {
  id              Int              @id @default(autoincrement())
  name            String
  createdAt       DateTime?        @default(now())
  updatedAt       DateTime?        @updatedAt
  originalDeckId  Int?
  uniqueUrl       String           @unique
  description     String?          @default("")
  userId          Int?
  isShopDeck      Boolean          @default(false)
  isPublished     Boolean          @default(false)
  shopSlug        String?          @unique
  shopUrl         String?
  originalDeck    Deck?            @relation("OriginalDeck", fields: [originalDeckId], references: [id])
  forks           Deck[]           @relation("OriginalDeck")
  user            User?            @relation(fields: [userId], references: [id])
  deckCards       DeckCard[]
  gameLogs        GameLog[]
  tournamentDecks TournamentDeck[]

  @@index([originalDeckId])
  @@index([userId])
  @@index([isShopDeck])
}

model DeckCard {
  id       Int  @id @default(autoincrement())
  deckId   Int
  cardId   Int
  quantity Int  @default(1)
  card     Card @relation(fields: [cardId], references: [id], onDelete: Cascade)
  deck     Deck @relation(fields: [deckId], references: [id])

  @@index([cardId])
  @@index([deckId])
}

model GameLog {
  id               Int           @id @default(autoincrement())
  userId           Int
  deckId           Int
  opponentLeaderId Int
  isWin            Boolean
  wentFirst        Boolean
  opponentName     String?
  comments         String?       @db.Text
  playedAt         DateTime      @default(now())
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  deck             Deck          @relation(fields: [deckId], references: [id], onDelete: Cascade)
  opponentLeader   Card          @relation("OpponentLeader", fields: [opponentLeaderId], references: [id])
  user             User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  finalHandCards   GameLogCard[]

  @@index([deckId])
  @@index([opponentLeaderId])
  @@index([userId])
}

model GameLogCard {
  id        Int     @id @default(autoincrement())
  gameLogId Int
  cardId    Int
  card      Card    @relation(fields: [cardId], references: [id], onDelete: Cascade)
  gameLog   GameLog @relation(fields: [gameLogId], references: [id], onDelete: Cascade)

  @@index([cardId])
  @@index([gameLogId])
}

model CardRuling {
  id       Int    @id @default(autoincrement())
  cardId   Int
  question String @db.Text
  answer   String @db.Text
  card     Card   @relation(fields: [cardId], references: [id], onDelete: Cascade)

  @@index([cardId])
}

model CardCondition {
  id        Int    @id @default(autoincrement())
  cardId    Int
  condition String
  card      Card   @relation(fields: [cardId], references: [id], onDelete: Cascade)

  @@index([cardId])
}

model CardType {
  id     Int    @id @default(autoincrement())
  cardId Int
  type   String
  card   Card   @relation(fields: [cardId], references: [id], onDelete: Cascade)

  @@index([cardId])
}

model CardColor {
  id     Int    @id @default(autoincrement())
  cardId Int
  color  String
  card   Card   @relation(fields: [cardId], references: [id], onDelete: Cascade)

  @@index([cardId])
}

model CardEffect {
  id     Int    @id @default(autoincrement())
  cardId Int
  effect String
  card   Card   @relation(fields: [cardId], references: [id], onDelete: Cascade)

  @@index([cardId])
}

model CardText {
  id     Int    @id @default(autoincrement())
  cardId Int
  text   String @db.Text
  card   Card   @relation(fields: [cardId], references: [id], onDelete: Cascade)

  @@index([cardId])
}

enum TournamentStatus {
  UPCOMING
  ONGOING
  COMPLETED
  CANCELLED
}

enum AnnouncementAudience {
  ALL
  AUTH
  GUEST
}

enum AnnouncementStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum AnnouncementEventType {
  IMPRESSION
  DISMISS
  CLICK
}

model TournamentSource {
  id           Int          @id @default(autoincrement())
  slug         String       @unique
  name         String
  baseUrl      String
  description  String?
  lastSyncedAt DateTime?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  tournaments  Tournament[]
}

model Tournament {
  id                  Int              @id @default(autoincrement())
  sourceId            Int
  source              TournamentSource @relation(fields: [sourceId], references: [id], onDelete: Cascade)
  sourceTournamentId  String
  type                TournamentType?
  name                String
  region              String?
  country             String?
  format              String?
  playerCount         Int?
  isPlayerCountApprox Boolean          @default(false)
  winnerName          String?
  winnerUrl           String?
  eventDate           DateTime
  tournamentUrl       String
  status              TournamentStatus @default(COMPLETED)
  createdAt           DateTime         @default(now())
  updatedAt           DateTime         @updatedAt
  decks               TournamentDeck[]

  @@unique([sourceId, sourceTournamentId])
  @@index([eventDate])
  @@index([status])
}

enum TournamentType {
  REGIONAL
  CHAMPIONSHIP
  TREASURE_CUP
}

model TournamentDeck {
  id            Int        @id @default(autoincrement())
  tournamentId  Int
  deckId        Int?
  leaderCardId  Int?
  playerId      Int?
  playerName    String
  standing      Int?
  wins          Int?
  losses        Int?
  draws         Int?
  deckSourceUrl String?
  archetypeName String?
  sourceDeckRef String?    @unique
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  tournament    Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  deck          Deck?      @relation(fields: [deckId], references: [id])
  leaderCard    Card?      @relation("TournamentLeaderCard", fields: [leaderCardId], references: [id])
  player        Player?    @relation(fields: [playerId], references: [id])

  @@index([tournamentId])
  @@index([deckId])
  @@index([leaderCardId])
  @@index([playerId])
}

model Player {
  id                Int             @id @default(autoincrement())
  name              String
  playerUrl         String?
  source            String
  sourcePlayerId    String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  tournamentDecks   TournamentDeck[]

  @@unique([source, sourcePlayerId])
  @@index([name])
}

model User {
  id            Int        @id @default(autoincrement())
  email         String     @unique
  name          String
  createdAt     DateTime?  @default(now()) @map("createdAt")
  updatedAt     DateTime?  @updatedAt @map("updatedAt")
  role          String     @default("USER")
  emailVerified DateTime?
  image         String?
  uuid          String     @unique @default(uuid())
  accounts      Account[]
  decks         Deck[]
  gameLogs      GameLog[]
  sessions      Session[]
  lists         UserList[]
  announcementEvents AnnouncementEvent[]
}

model Account {
  id                Int     @id @default(autoincrement())
  userId            Int
  type              String
  provider          String
  providerAccountId String  @unique
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id           Int      @id @default(autoincrement())
  sessionToken String   @unique
  userId       Int
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model UserList {
  id           Int                @id @default(autoincrement())
  userId       Int
  name         String
  description  String?
  isOrdered    Boolean            @default(false)
  isDeletable  Boolean            @default(true)
  isCollection Boolean            @default(false)
  maxRows      Int?
  maxColumns   Int?
  totalPages   Int                @default(1)
  color        String?
  isPublic     Boolean            @default(false)
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  user         User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  cards        UserListCard[]
  backcards    UserListBackcard[] // üé¥ Relaci√≥n con backcards

  @@unique([userId, name])
  @@index([userId, isPublic])
  @@index([userId, isCollection])
}

model UserListCard {
  id        Int      @id @default(autoincrement())
  listId    Int
  cardId    Int
  quantity  Int      @default(1)
  sortOrder Int?
  page      Int?
  row       Int?
  column    Int?
  notes     String?
  condition String?
  customPrice   Decimal?
  customCurrency String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  card      Card     @relation(fields: [cardId], references: [id], onDelete: Cascade)
  list      UserList @relation(fields: [listId], references: [id], onDelete: Cascade)

  @@unique([listId, page, row, column], name: "unique_physical_position")
  @@index([listId, cardId])
  @@index([listId, sortOrder])
  @@index([cardId])
}

// üé¥ Modelo para almacenar posiciones de backcard
model UserListBackcard {
  id        Int      @id @default(autoincrement())
  listId    Int
  page      Int
  row       Int
  column    Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  list      UserList @relation(fields: [listId], references: [id], onDelete: Cascade)

  @@unique([listId, page, row, column], name: "unique_backcard_position")
  @@index([listId])
}

model Announcement {
  id         Int                   @id @default(autoincrement())
  titleEn    String
  bodyEn     String
  ctaLabelEn String?
  titleEs    String?
  bodyEs     String?
  ctaLabelEs String?
  ctaUrl     String?
  audience   AnnouncementAudience @default(ALL)
  status     AnnouncementStatus   @default(DRAFT)
  screens    String[]
  startAt    DateTime?
  endAt      DateTime?
  priority   Int                  @default(0)
  version    Int                  @default(1)
  showOnce   Boolean              @default(true)
  createdAt  DateTime             @default(now())
  updatedAt  DateTime             @updatedAt
  events     AnnouncementEvent[]

  @@index([status, startAt, endAt])
  @@index([priority])
}

model AnnouncementEvent {
  id             Int                   @id @default(autoincrement())
  announcementId Int
  userId         Int?
  visitorId      String?
  type           AnnouncementEventType
  screen         String?
  locale         String?
  createdAt      DateTime              @default(now())
  announcement   Announcement          @relation(fields: [announcementId], references: [id], onDelete: Cascade)
  user           User?                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([announcementId])
  @@index([userId])
  @@index([visitorId])
  @@index([type])
}

model Event {
  id              Int                @id @default(autoincrement())
  slug            String             @unique // Identificador generado (ej: "na-store-tournament-vol-5")
  title           String             @map("name")
  description     String?            @db.Text
  content         String?            @db.Text
  originalContent String?            @db.Text
  locale          String?            @default("en")
  region          EventRegion        @default(GLOBAL)
  status          EventStatus        @default(UPCOMING)
  eventType       EventType          @default(OTHER)
  category        EventCategory?
  startDate       DateTime?          @map("event_date")
  endDate         DateTime?
  rawDateText     String?
  location        String?
  sourceUrl       String?
  imageUrl        String?
  eventThumbnail  String?
  listOrder       Int?
  eventTxt        String?
  isApproved      Boolean            @default(false)
  createdAt       DateTime?          @default(now())
  updatedAt       DateTime?          @updatedAt
  sets            EventSet[]
  cards           EventCard[]
  products        EventProduct[]
  missingSets     EventMissingSet[]
  missingCards    EventMissingCard[]
}

model Set {
  id          Int        @id @default(autoincrement())
  image       String
  title       String
  originalTitle String?
  translatedTitle String?
  code        String?
  region      String?
  releaseDate DateTime   @map("release_date")
  isOpen      Boolean    @default(false) @map("is_open")
  createdAt   DateTime?  @default(now()) @map("created_at")
  updatedAt   DateTime?  @updatedAt @map("updated_at")
  version     String?
  aliasesJson Json?
  cards       CardSet[]
  events      EventSet[]
  products    Product[]
  @@index([region])
}

model Product {
  id          Int         @id @default(autoincrement())
  uuid        String      @unique @default(uuid())
  name        String
  description String?     @db.Text
  imageUrl    String?
  thumbnailUrl String?
  imageKey    String?
  productType ProductType
  releaseDate DateTime?
  officialPrice Decimal?
  officialPriceCurrency String?
  metadata    Json?
  isArchived Boolean    @default(false)
  archivedAt DateTime?

  // TCGplayer linking (same pattern as Card model)
  tcgUrl              String?   @default("")
  tcgplayerProductId  String?   @unique
  tcgplayerLinkStatus Boolean? // null = not attempted, false = marked missing, true = linked
  marketPrice         Decimal?
  lowPrice            Decimal?
  highPrice           Decimal?
  priceCurrency       String?   @default("USD")
  priceUpdatedAt      DateTime?

  // Optional relationship with Set (products can exist independently)
  setId Int?
  set   Set? @relation(fields: [setId], references: [id], onDelete: SetNull)

  // Many-to-many relationship with Events
  events EventProduct[]
  cards  ProductCard[]
  relatedProducts ProductLink[] @relation("ProductLinkSource")
  relatedToProducts ProductLink[] @relation("ProductLinkTarget")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([productType])
  @@index([setId])
  @@index([tcgplayerProductId])
  @@index([releaseDate])
  @@index([isArchived])
}

model ProductCard {
  productId Int
  cardId    Int
  createdAt DateTime @default(now())
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  card      Card     @relation(fields: [cardId], references: [id], onDelete: Cascade)

  @@id([productId, cardId])
  @@index([cardId])
}

model ProductLink {
  sourceProductId Int
  targetProductId Int
  createdAt       DateTime @default(now())
  sourceProduct   Product  @relation("ProductLinkSource", fields: [sourceProductId], references: [id], onDelete: Cascade)
  targetProduct   Product  @relation("ProductLinkTarget", fields: [targetProductId], references: [id], onDelete: Cascade)

  @@id([sourceProductId, targetProductId])
  @@index([targetProductId])
}

model MissingProduct {
  id                     Int      @id @default(autoincrement())
  title                  String
  sourceUrl              String?
  productType            ProductType?
  category               String?
  releaseDate            DateTime?
  officialPrice          Decimal?
  officialPriceCurrency  String?
  thumbnailUrl           String?
  imagesJson             Json?
  isApproved             Boolean  @default(false)
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
}

model EventSet {
  eventId Int
  setId   Int
  event   Event @relation(fields: [eventId], references: [id], onDelete: Cascade)
  set     Set   @relation(fields: [setId], references: [id], onDelete: Cascade)

  @@id([eventId, setId])
  @@index([setId])
}

model EventCard {
  eventId Int
  cardId  Int
  event   Event @relation(fields: [eventId], references: [id], onDelete: Cascade)
  card    Card  @relation(fields: [cardId], references: [id], onDelete: Cascade)

  @@id([eventId, cardId])
  @@index([cardId])
}

model EventProduct {
  eventId   Int
  productId Int
  createdAt DateTime @default(now())
  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@id([eventId, productId])
  @@index([productId])
}

model MissingSet {
  id               Int               @id @default(autoincrement())
  title            String            @unique
  translatedTitle  String?
  imagesJson       Json?
  versionSignature String?
  isProduct        Boolean           @default(false)
  productType      ProductType?
  isApproved       Boolean           @default(false)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  events           EventMissingSet[]
}

model EventMissingSet {
  id           Int        @id @default(autoincrement())
  eventId      Int
  missingSetId Int
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  event        Event      @relation(fields: [eventId], references: [id], onDelete: Cascade)
  missingSet   MissingSet @relation(fields: [missingSetId], references: [id], onDelete: Cascade)

  @@unique([eventId, missingSetId])
  @@index([eventId])
  @@index([missingSetId])
}

model MissingCard {
  id         Int                @id @default(autoincrement())
  code       String
  title      String
  imageUrl   String
  isApproved Boolean            @default(false)
  createdAt  DateTime           @default(now())
  updatedAt  DateTime           @updatedAt
  events     EventMissingCard[]

  @@unique([code, title, imageUrl], name: "code_title_imageUrl")
  @@index([code])
}

model EventMissingCard {
  id            Int         @id @default(autoincrement())
  eventId       Int
  missingCardId Int
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  event         Event       @relation(fields: [eventId], references: [id], onDelete: Cascade)
  missingCard   MissingCard @relation(fields: [missingCardId], references: [id], onDelete: Cascade)

  @@unique([eventId, missingCardId])
  @@index([eventId])
  @@index([missingCardId])
}

model CardSet {
  cardId Int
  setId  Int
  id     Int  @id @default(autoincrement())
  card   Card @relation(fields: [cardId], references: [id], onDelete: Cascade)
  set    Set  @relation(fields: [setId], references: [id], onDelete: Cascade)

  @@index([cardId])
  @@index([setId])
}

enum PriceType {
  MARKET
  LOW
  HIGH
}

model CardPriceLog {
  id          Int       @id @default(autoincrement())
  cardId      Int
  priceType   PriceType
  price       Decimal
  source      String    @default("TCGplayer")
  collectedAt DateTime  @default(now())
  createdAt   DateTime  @default(now())
  card        Card      @relation(fields: [cardId], references: [id], onDelete: Cascade)

  @@index([cardId])
  @@index([collectedAt])
}

model CardPriceAlert {
  id                 Int                     @id @default(autoincrement())
  cardId             Int
  thresholdType      AlertThresholdType
  thresholdValue     Decimal?
  percentChange      Float?
  percentWindowHours Int?                    @default(24)
  notificationMethod AlertNotificationMethod @default(IN_APP)
  isActive           Boolean                 @default(true)
  createdAt          DateTime                @default(now())
  updatedAt          DateTime                @updatedAt
  card               Card                    @relation(fields: [cardId], references: [id], onDelete: Cascade)
  logs               CardPriceAlertLog[]
  notifications      AdminNotification[]

  @@index([cardId, isActive])
}

enum AlertThresholdType {
  ABOVE_VALUE
  BELOW_VALUE
  PERCENT_CHANGE
}

enum AlertNotificationMethod {
  IN_APP
  EMAIL
  SLACK
}

model CardPriceAlertLog {
  id          Int            @id @default(autoincrement())
  alertId     Int
  cardId      Int
  price       Decimal
  triggeredAt DateTime       @default(now())
  priceType   PriceType      @default(MARKET)
  alert       CardPriceAlert @relation(fields: [alertId], references: [id], onDelete: Cascade)
  card        Card           @relation(fields: [cardId], references: [id], onDelete: Cascade)

  @@index([alertId])
  @@index([cardId, triggeredAt])
}

enum AdminNotificationType {
  PRICE_ALERT
  SYSTEM
}

model AdminNotification {
  id        Int                   @id @default(autoincrement())
  title     String?
  message   String
  type      AdminNotificationType @default(PRICE_ALERT)
  isRead    Boolean               @default(false)
  metadata  Json?
  cardId    Int?
  alertId   Int?
  createdAt DateTime              @default(now())
  updatedAt DateTime              @updatedAt
  card      Card?                 @relation(fields: [cardId], references: [id], onDelete: SetNull)
  alert     CardPriceAlert?       @relation(fields: [alertId], references: [id], onDelete: SetNull)

  @@index([isRead, type])
  @@index([cardId])
  @@index([alertId])
}

model CatalogProduct {
  id          Int                @id @default(autoincrement())
  uuid        String             @unique @default(uuid())
  name        String
  description String?            @db.Text
  imageUrl    String?
  releaseDate DateTime?
  productType CatalogProductType
  metadata    Json?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt

  @@index([productType])
}

model TcgCatalogProduct {
  productId       Int       @id
  name            String
  cleanName       String?
  productLineName String?
  url             String?
  sku             String?
  imageUrl        String?
  metadata        Json?
  cardType        String?
  rarity          String?
  isSealed        Boolean   @default(false)
  lastSyncedAt    DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  linkedCardId    Int?
  linkedProductId Int? // Link to Product model (for sealed products, playmats, etc.)
  linkedAt        DateTime?
  linkedById      Int?
  productStatus   String?   @default("active")

  @@index([linkedCardId])
  @@index([linkedProductId])
  @@index([linkedById])
}

// Shop cart/orders models removed - moved to separate e-commerce application

enum ProductType {
  BOOSTER
  DECK
  STARTER_DECK
  PREMIUM_BOOSTER_BOX
  PLAYMAT
  SLEEVE
  DECK_BOX
  STORAGE_BOX
  UNCUT_SHEET
  PROMO_PACK
  DISPLAY_BOX
  COLLECTORS_SET
  TIN_PACK
  ILLUSTRATION_BOX
  ANNIVERSARY_SET
  PREMIUM_CARD_COLLECTION
  DOUBLE_PACK
  DEVIL_FRUIT
  OTHER
}

enum CatalogProductType {
  BOOSTER
  DECK
  OTHER
}

enum Role {
  ADMIN
  USER
}

enum EventRegion {
  GLOBAL
  NA
  EU
  LA
  ASIA
  JP
}

enum EventStatus {
  UPCOMING
  ONGOING
  COMPLETED
}

enum EventType {
  STORE_TOURNAMENT
  CHAMPIONSHIP
  RELEASE_EVENT
  ONLINE
  OTHER
}

enum EventCategory {
  BEGINNER
  ROOKIES
  INTERMEDIATE
  COMPETITIVE
}
